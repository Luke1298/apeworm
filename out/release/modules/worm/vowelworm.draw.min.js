(function(){window.VowelWorm.module("draw",function(l){this.minDecibels=-250;this.maxDecibels=-30;this.create=function(a,b,c){if(this._stage)throw Error("Only one view per VowelWorm.instance allowed.");if(void 0===c||null===c)c=16777215;this._stage=new PIXI.Stage(c);this._renderer=PIXI.autoDetectRenderer(a,b);this._renderer.render(this._stage);return this._renderer.view};this._drawYAxis=function(a){var b=new PIXI.DisplayObjectContainer;this._axes.push(b);var c=this.maxDecibels,f=this.minDecibels,e=this._renderer,
k=this._stage,h=new PIXI.Text("db",{font:"10px",color:a});h.position.x=0;h.position.y=0;for(var f=(f-c)/e.height,g=50;g<=e.height;g+=50){var d=Math.round(10*(g*f+c))/10,d=new PIXI.Text(d,{font:"10px",color:a});d.position.x=5;d.position.y=g-d.height/2;b.addChild(d)}b.addChild(h);k.addChild(b)};this._drawXAxis=function(a){var b=new PIXI.DisplayObjectContainer;this._axes.push(b);var c=this._renderer,f=this._stage,e=c.height-10,k=e-5,h=new PIXI.Text("kHz",{font:"10px",color:a});h.position.x=50-h.width/
2;h.position.y=e;b.addChild(h);for(var h=l.getFFTSize()/2/c.width,g=50;g<c.width;g+=50){var d=new PIXI.Graphics;d.lineStyle(1,a);d.moveTo(g,e);d.lineTo(g,k);b.addChild(d);d=l._toFrequency(g*h,l.getSampleRate(),l.getFFTSize());d/=1E3;d=parseFloat(d.toFixed(2));d=new PIXI.Text(d,{font:"10px",color:a});d.position.x=g-d.width/2;d.position.y=k-10;b.addChild(d);f.addChild(b)}};this.drawAxes=function(a){if(!this._stage)throw Error("You must call draw.create() before you can draw axes.");if(void 0===a||null===
a)a=0;this._axes=this._axes||[];for(var b=null;b=this._axes.pop();)this._stage.removeChild(b);this._drawXAxis(a);this._drawYAxis(a);this._renderer.render(this._stage)};this.makeValuesGraphable=function(a){for(var b=0;b<a.length;b++)a[b]=this.decibelsToPixels(a[b])};this.decibelsToPixels=function(a){var b=this._renderer.height,c=this.minDecibels,f=this.maxDecibels;return b/(c-f)*a-b/(c-f)*f};this.drawDataLines=function(){var a=this._stage,b=this._renderer,c=l.getFFT(),f=l.hann(c,75).slice(window.VowelWorm.HANNING_SHIFT);
this.makeValuesGraphable(c);this.makeValuesGraphable(f);var e=b.width/c.length;this.raw_line&&a.removeChild(this.raw_line);this.raw_line=this.drawLine(c,0,e);this.smoothed_line&&a.removeChild(this.smoothed_line);this.smoothed_line=this.drawLine(f,16711680,e);this.peaks&&a.removeChild(this.peaks);this.peaks=this.drawPeaks(l.getFormants(),0);b.render(a)};this.drawLine=function(a,b,c){var f=this._stage,e=new PIXI.Graphics;e.lineStyle(1,b);e.moveTo(0,a[0]);for(b=0;b<a.length;b++)e.lineTo(b*c,a[b]);f.addChild(e);
return e};this.hertzToPixels=function(a){return this._renderer.width*a/(l.getSampleRate()/2)};this.drawPeaks=function(a,b){var c=this._stage,f=this._renderer,e=new PIXI.Graphics;e.lineStyle(1,b);for(var k=0;k<a.length;k++)e.moveTo(this.hertzToPixels(a[k]),0),e.lineTo(this.hertzToPixels(a[k]),f.height);c.addChild(e);return e}});}).call(this);
